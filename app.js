// Language translations
const translations = {
    hr: {
        // Navigation
        nav_home: "Početna",
        nav_about: "O nama",
        nav_services: "Usluge",
        nav_stylists: "Naše frizerke",
        nav_contact: "Kontakt",
        
        // Hero section
        hero_title: "Frizerski salon Ružica & Branka",
        hero_subtitle: "Dvije profesionalne frizerke u srcu Čapljine",
        hero_description: "Odkrijte savršenu kombinaciju stila i iskustva u našem salonu koji djeluje već preko 20 godina",
        hero_cta: "Rezervirajte termin",
        
        // About section
        about_title: "O našem salonu",
        about_subtitle: "Vaš partneri za savršen izgled od 2001. godine",
        about_text1: "Frizerski salon Ružica & Branka osnovane je 2001. godine u Čapljini. Tokom više od 20 godina rada, postali smo sinonim za kvalitetu, profesionalnost i inovativne frizure.",
        about_text2: "Naš tim čine dvije iskusne frizerke, Ružica i Branka, koje kontinuirano prate najnovije trendove u svijetu frizerstva i kozmetike. Svaki klijent je za nas jedinstven, te pristupamo svakom individualnom zahtjevu s posebnom pažnjom.",
        stat_established: "Godina osnivanja",
        stat_experience: "Godina iskustva",
        stat_stylists: "Profesionalne frizerke",
        
        // Services section
        services_title: "Naše usluge",
        services_subtitle: "Profesionalne frizerske usluge za sve vaše potrebe",
        service_womens: "Žensko šišanje i styling",
        service_womens_desc: "Kreativno šišanje i styling prilagođen vašoj osobnosti",
        service_mens: "Muško šišanje i oblikovanje brade",
        service_mens_desc: "Moderna muška frizura i precizno oblikovanje brade",
        service_coloring: "Profesionalno farbanje kose",
        service_coloring_desc: "Kvalitetni proizvodi za dugotrajnu boju",
        service_special: "Svečane frizure",
        service_special_desc: "Elegantne frizure za posebne prilike",
        service_styling: "Feniranje i kreiranje lokni",
        service_styling_desc: "Profesionalno oblikovanje za savršen volumen",
        service_balayage: "Balayage i moderne tehnike",
        service_balayage_desc: "Najnovije tehnike bojenja za prirodan izgled",
        
        // Stylists section
        stylists_title: "Naše frizerke",
        stylists_subtitle: "Upoznajte naš profesionalni tim",
        branka_desc: "Iskusna profesionalka s dugogodišnjim iskustvom u frizerstvu",
        ruzica_desc: "Kreativna frizerka koja prati najnovije trendove u frizerstvu",
        contact_branka: "Kontaktirajte Frizerku Branku",
        contact_ruzica: "Kontaktirajte Frizerku Ružicu",
        
        // Contact section
        contact_title: "Kontakt",
        contact_subtitle: "Pronađite nas i zakažite svoj termin",
        contact_address_title: "Adresa",
        contact_maps: "Pogledaj na Google Maps",
        contact_hours_title: "Radno vrijeme",
        contact_hours: "Ponedjeljak - Petak: 8:00 - 20:00<br>Subota: 8:00 - 16:00<br>Nedjelja: Zatvoreno",
        contact_reservation_title: "Rezervacija",
        contact_reservation_text: "Zakažite svoj termin unaprijed",
        contact_book: "Rezervirajte termin",
        
        // Footer
        footer_text: "&copy; 2024 Frizerski salon Ružica & Branka. Sva prava zadržana.",
        
        // Modal
        modal_title: "Rezervirajte termin",
        modal_text: "Za rezervaciju termina, molimo kontaktirajte jednu od naših frizerki:"
    },
    en: {
        // Navigation
        nav_home: "Home",
        nav_about: "About",
        nav_services: "Services",
        nav_stylists: "Our Stylists",
        nav_contact: "Contact",
        
        // Hero section
        hero_title: "Hair Salon Ružica & Branka",
        hero_subtitle: "Two professional hairstylists in the heart of Čapljina",
        hero_description: "Discover the perfect combination of style and experience in our salon operating for over 20 years",
        hero_cta: "Book Appointment",
        
        // About section
        about_title: "About Our Salon",
        about_subtitle: "Your partners for the perfect look since 2001",
        about_text1: "Hair Salon Ružica & Branka was established in 2001 in Čapljina. Over more than 20 years of operation, we have become synonymous with quality, professionalism, and innovative hairstyles.",
        about_text2: "Our team consists of two experienced hairstylists, Ružica and Branka, who continuously follow the latest trends in hairdressing and cosmetics. Every client is unique to us, and we approach each individual request with special attention.",
        stat_established: "Year Established",
        stat_experience: "Years of Experience",
        stat_stylists: "Professional Stylists",
        
        // Services section
        services_title: "Our Services",
        services_subtitle: "Professional hair services for all your needs",
        service_womens: "Women's Haircuts & Styling",
        service_womens_desc: "Creative cuts and styling tailored to your personality",
        service_mens: "Men's Haircuts & Beard Shaping",
        service_mens_desc: "Modern men's hairstyles and precise beard shaping",
        service_coloring: "Professional Hair Coloring",
        service_coloring_desc: "Quality products for long-lasting color",
        service_special: "Special Occasion Hairstyles",
        service_special_desc: "Elegant hairstyles for special occasions",
        service_styling: "Blow-drying & Curling",
        service_styling_desc: "Professional styling for perfect volume",
        service_balayage: "Balayage & Modern Techniques",
        service_balayage_desc: "Latest coloring techniques for natural look",
        
        // Stylists section
        stylists_title: "Our Stylists",
        stylists_subtitle: "Meet our professional team",
        branka_desc: "Experienced professional with years of expertise in hairdressing",
        ruzica_desc: "Creative stylist who follows the latest trends in hairdressing",
        contact_branka: "Contact Stylist Branka",
        contact_ruzica: "Contact Stylist Ružica",
        
        // Contact section
        contact_title: "Contact",
        contact_subtitle: "Find us and schedule your appointment",
        contact_address_title: "Address",
        contact_maps: "View on Google Maps",
        contact_hours_title: "Working Hours",
        contact_hours: "Monday - Friday: 8:00 - 20:00<br>Saturday: 8:00 - 16:00<br>Sunday: Closed",
        contact_reservation_title: "Reservation",
        contact_reservation_text: "Schedule your appointment in advance",
        contact_book: "Book Appointment",
        
        // Footer
        footer_text: "&copy; 2024 Hair Salon Ružica & Branka. All rights reserved.",
        
        // Modal
        modal_title: "Book Appointment",
        modal_text: "To book an appointment, please contact one of our stylists:"
    }
};

// Current language and theme state
let currentLanguage = 'hr';
let currentTheme = 'light';

// DOM elements
const languageToggle = document.getElementById('language-toggle');
const currentLangSpan = document.getElementById('current-lang');
const otherLangSpan = document.getElementById('other-lang');
const navbarToggle = document.getElementById('navbar-toggle');
const navbarMenu = document.getElementById('navbar-menu');
const themeToggleBtn = document.getElementById('theme-toggle-btn');

// Initialize the application
document.addEventListener('DOMContentLoaded', function() {
    initializeLanguage();
    initializeTheme();
    setupEventListeners();
    setupAnimations();
});

// Language functionality
function initializeLanguage() {
    // Check if there's a saved language preference
    const savedLanguage = sessionStorage.getItem('salon-language');
    if (savedLanguage) {
        currentLanguage = savedLanguage;
    }
    
    updateLanguageDisplay();
    translatePage();
    updateDocumentLanguage();
}

function updateLanguageDisplay() {
    if (currentLanguage === 'hr') {
        currentLangSpan.textContent = 'HR';
        otherLangSpan.textContent = 'EN';
    } else {
        currentLangSpan.textContent = 'EN';
        otherLangSpan.textContent = 'HR';
    }
}

function updateDocumentLanguage() {
    document.documentElement.lang = currentLanguage;
}

function toggleLanguage() {
    currentLanguage = currentLanguage === 'hr' ? 'en' : 'hr';
    sessionStorage.setItem('salon-language', currentLanguage);
    updateLanguageDisplay();
    translatePage();
    updateDocumentLanguage();
}

function translatePage() {
    const elements = document.querySelectorAll('[data-translate]');
    
    elements.forEach(element => {
        const key = element.getAttribute('data-translate');
        if (translations[currentLanguage] && translations[currentLanguage][key]) {
            if (key.includes('_hours') || key.includes('footer_text')) {
                element.innerHTML = translations[currentLanguage][key];
            } else {
                element.textContent = translations[currentLanguage][key];
            }
        }
    });
}

// Theme functionality
function initializeTheme() {
    // Check if there's a saved theme preference
    const savedTheme = sessionStorage.getItem('salon-theme');
    if (savedTheme) {
        currentTheme = savedTheme;
        document.documentElement.setAttribute('data-theme', currentTheme);
    } else {
        // Use the system preference if no saved preference
        const systemPrefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
        currentTheme = systemPrefersDark ? 'dark' : 'light';
        document.documentElement.setAttribute('data-theme', currentTheme);
    }
    
    updateThemeToggleDisplay();
}

function updateThemeToggleDisplay() {
    const lightIcon = document.getElementById('light-icon');
    const darkIcon = document.getElementById('dark-icon');
    
    if (currentTheme === 'dark') {
        lightIcon.style.display = 'none';
        darkIcon.style.display = 'block';
    } else {
        lightIcon.style.display = 'block';
        darkIcon.style.display = 'none';
    }
}

function toggleTheme() {
    currentTheme = currentTheme === 'light' ? 'dark' : 'light';
    sessionStorage.setItem('salon-theme', currentTheme);
    document.documentElement.setAttribute('data-theme', currentTheme);
    updateThemeToggleDisplay();
}

// Navigation functionality
function setupEventListeners() {
    // Theme toggle
    if (themeToggleBtn) {
        themeToggleBtn.addEventListener('click', toggleTheme);
    }
    
    // Language toggle
    if (languageToggle) {
        languageToggle.addEventListener('click', toggleLanguage);
    }
    
    // Mobile menu toggle
    if (navbarToggle) {
        navbarToggle.addEventListener('click', toggleMobileMenu);
    }
    
    // Close mobile menu when clicking on links
    const navLinks = document.querySelectorAll('.navbar__link');
    navLinks.forEach(link => {
        link.addEventListener('click', closeMobileMenu);
    });
    
    // Close mobile menu when clicking outside
    document.addEventListener('click', function(event) {
        if (navbarMenu && !navbarMenu.contains(event.target) && !navbarToggle.contains(event.target)) {
            closeMobileMenu();
        }
    });
    
    // Smooth scroll for all navigation links and hero CTA
    const allLinks = document.querySelectorAll('a[href^="#"]');
    allLinks.forEach(link => {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            const targetId = this.getAttribute('href');
            const targetSection = document.querySelector(targetId);
            
            if (targetSection) {
                const headerHeight = document.querySelector('.header').offsetHeight;
                const targetPosition = targetSection.offsetTop - headerHeight;
                
                window.scrollTo({
                    top: targetPosition,
                    behavior: 'smooth'
                });
                
                // Close mobile menu if open
                closeMobileMenu();
            }
        });
    });
    
    // Header scroll effect
    window.addEventListener('scroll', debounce(handleHeaderScroll, 10));

    // Listen for system theme changes
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', function(e) {
        if (!sessionStorage.getItem('salon-theme')) {
            currentTheme = e.matches ? 'dark' : 'light';
            document.documentElement.setAttribute('data-theme', currentTheme);
            updateThemeToggleDisplay();
        }
    });
}

function toggleMobileMenu() {
    if (navbarMenu && navbarToggle) {
        navbarMenu.classList.toggle('active');
        navbarToggle.classList.toggle('active');
    }
}

function closeMobileMenu() {
    if (navbarMenu && navbarToggle) {
        navbarMenu.classList.remove('active');
        navbarToggle.classList.remove('active');
    }
}

function handleHeaderScroll() {
    const header = document.querySelector('.header');
    if (header) {
        const scrolled = window.scrollY;
        
        if (scrolled > 100) {
            header.style.background = currentTheme === 'dark' 
                ? 'rgba(17, 17, 17, 0.95)' 
                : 'rgba(255, 255, 253, 0.95)';
            header.style.backdropFilter = 'blur(10px)';
        } else {
            header.style.background = 'var(--color-surface)';
            header.style.backdropFilter = 'none';
        }
    }
}

// Intersection Observer for animations
function setupAnimations() {
    const observerOptions = {
        threshold: 0.1,
        rootMargin: '0px 0px -50px 0px'
    };
    
    const observer = new IntersectionObserver(function(entries) {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.style.opacity = '1';
                entry.target.style.transform = 'translateY(0)';
            }
        });
    }, observerOptions);
    
    // Observe elements for animation
    const animatedElements = document.querySelectorAll('.service-card, .stylist-card, .contact__item, .stat');
    animatedElements.forEach(el => {
        el.style.opacity = '0';
        el.style.transform = 'translateY(20px)';
        el.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
        observer.observe(el);
    });
}

// Performance optimization: Debounce scroll events
function debounce(func, wait) {
    let timeout;
    return function executedFunction(...args) {
        const later = () => {
            clearTimeout(timeout);
            func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
    };
}

// Utility function to check if an element is in viewport
function isInViewport(element) {
    const rect = element.getBoundingClientRect();
    return (
        rect.top >= 0 &&
        rect.left >= 0 &&
        rect.bottom <= (window.innerHeight || document.documentElement.clientHeight) &&
        rect.right <= (window.innerWidth || document.documentElement.clientWidth)
    );
}

// Handle resize events
window.addEventListener('resize', debounce(function() {
    // Close mobile menu on resize
    closeMobileMenu();
}, 250));

// Error handling for images
document.addEventListener('DOMContentLoaded', function() {
    const images = document.querySelectorAll('img');
    images.forEach(img => {
        img.addEventListener('error', function() {
            this.style.opacity = '0.5';
            this.alt = 'Slika se ne može učitati';
            console.warn('Image failed to load:', this.src);
        });
        
        img.addEventListener('load', function() {
            this.style.opacity = '1';
        });
    });
});